{{- if .Values.apps.mi.enabled -}}
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: mi-web
#   namespace: fmhv
#   annotations:
#     kubernetes.io/ingress.class: alb
#     alb.ingress.kubernetes.io/target-type: 'ip'
#     alb.ingress.kubernetes.io/scheme: internet-facing
#     alb.ingress.kubernetes.io/certificate-arn: {{ .Values.apps.acm_cert_arn }}
#     alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-1-2017-01
#     alb.ingress.kubernetes.io/load-balancer-attributes: routing.http2.enabled=true
#     alb.ingress.kubernetes.io/load-balancer-name: mi-web
#     alb.ingress.kubernetes.io/healthcheck-path: /health
#     external-dns.alpha.kubernetes.io/hostname: admin.{{ .Values.awsAccountAlias }}.fotomerchanthv.com

#     nginx.ingress.kubernetes.io/ssl-redirect: "true"
#     nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
#     nginx.ingress.kubernetes.io/backend-protocol: HTTP
    
    

#     # nginx.ingress.kubernetes.io/backend-protocol: "FCGI"
#     # nginx.ingress.kubernetes.io/fastcgi-index: "index.php"
#     # nginx.ingress.kubernetes.io/fastcgi-params-configmap: "ingress-cm"
# spec:
#   tls:
#   - hosts:
#     - admin.{{ .Values.awsAccountAlias }}.fotomerchanthv.com
#   rules:
#   - host: admin.{{ .Values.awsAccountAlias }}.fotomerchanthv.com
#     http:
#       paths:
#         - path: /
#           pathType: Prefix
#           backend:
#             service:
#               name: mi-web
#               port:
#                 number: 80


apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ .Values.apps.mi.name}}
  namespace: fmhv
  annotations:
    {{- printf .Values.apps.ingress_definition_dns | nindent 4 }}
    external-dns.alpha.kubernetes.io/set-identifier: "{{ .Values.clusterName }}"
    external-dns.alpha.kubernetes.io/aws-weight: "{{ .Values.route53_weight }}"
spec:
  tls:
  - hosts:
    - admin.{{ .Values.awsAccountAlias }}.fotomerchanthv.com
    secretName: cert-mi
  rules:
  - host: admin.{{ .Values.awsAccountAlias }}.fotomerchanthv.com
    http:
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: mi-web
              port:
                number: 80
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ .Values.apps.mi.name}}-cluster
  namespace: fmhv
  annotations:
    {{- printf .Values.apps.ingress_definition_cluster_dns | nindent 4 }}
    external-dns.alpha.kubernetes.io/set-identifier: "{{ .Values.clusterName }}"
    external-dns.alpha.kubernetes.io/aws-weight: "100"
spec:
  tls:
    - hosts:
        - admin.{{ .Values.awsAccountAlias }}.{{ .Values.clusterName }}.fotomerchanthv.com
      secretName: cert-mi-cluster
  rules:
    - host: admin.{{ .Values.awsAccountAlias }}.{{ .Values.clusterName }}.fotomerchanthv.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: mi-web
                port:
                  number: 80
{{- end }}
